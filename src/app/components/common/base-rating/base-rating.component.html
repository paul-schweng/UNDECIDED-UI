<div *ngIf="!edit" class="row">
  <div class="col p-0 flex-grow-0 m-auto">
    <ngb-carousel *ngIf="_rating.images" [ngClass]="{'remove-carousel-control': _rating.images.length<=1}" [interval]="0"> <!--TODO:Geschwindigkeit vom bildwechsel-->
      <ng-template *ngFor="let image of _rating.images" ngbSlide>
        <div class="img-wrapper">
          <img [src]="image" alt="slide">
        </div>
      </ng-template>
    </ngb-carousel>
  </div>

  <div class="col m-1">
    <div class="row Text-Style-16">
      <span class="col">{{_rating.product.name}}</span>
        <div class="d-flex flex-grow-1 align-items-center">
          <mat-icon *ngFor="let label of _rating.labelList" class="d-flex"><img [src]="'assets/img/labels/'+ label.icon" alt="label"></mat-icon>
        </div>
      <span class="col" style="text-align: end">{{_rating.product?.brand}}</span>
    </div>

    <div class="line"></div>

    <div class="row">
      <div class="col w-50 mx-2 mt-4 p-1 border border-2 rounded">
        {{_rating.description}}
      </div>

      <div class="col list-margin">
        <div class="row w-100 align-items-center">
          <span class="d-inline-grid pr-5 Text-Style-17">REWE, 12345 Altrip
<!--            {{_rating.product.location?.name || 'location unknown'}} {{_rating.product.location?.plz || 'location unknown'}}-->
            <span class="Text-Style-18">schönweg 20<!--{{_rating.product.location?.street || 'location unknown'}}--></span>
          </span>
          <mat-icon *ngIf="_rating.location?.name">location_on</mat-icon>
          <mat-icon *ngIf="!_rating.location?.name">location_off</mat-icon>
        </div>

        <div class="row d-inline-flex align-items-center justify-content-center fix-height">
          <div class="image-wrapper mr-1" *ngFor="let friend of _rating.friends" [style]="'background-image: url(' + friend.profileImage + ');'"></div>
        </div>

        <mat-chip-list class="row w-100">
          <mat-chip *ngFor="let type of _rating.types">{{type}}</mat-chip>
        </mat-chip-list>

        <ngx-stars class="row justify-content-center" [size]="3" [initialStars]="_rating.stars" color="black" [readonly]="!edit"></ngx-stars>
      </div>
    </div>
  </div>
</div>








<div *ngIf="edit" class="row">

  <div class="col p-0 flex-grow-0 m-auto">
    <ngb-carousel *ngIf="_rating.images" [ngClass]="{'remove-carousel-control': _rating.images.length<=0}" [interval]="0" #carousel="ngbCarousel">
      <ng-template *ngFor="let image of _rating.images; let i = index" ngbSlide>
        <div class="img-wrapper">
          <img [src]="getImage(image)" alt="slide">
          <button (click)="deleteImage(i)" class="btn-delete m-2" mat-icon-button>
            <mat-icon class="mr-2 ml-2 color-red">delete</mat-icon>
          </button>
        </div>
      </ng-template>
      <ng-template *ngIf="_rating.images.length < MAX_IMAGES" ngbSlide>
        <div class="img-wrapper">
          <img src="assets/img/default_rate_pic.png" alt="last slide">
          <input
            style="display: none"
            accept="image/*"
            type="file" (change)="onFileChanged($event, carousel)"
            #fileInput>
          <button type="button" (click)="uploadImage(fileInput, carousel)" mat-stroked-button>{{'ratings.choosePicture' | translate}}</button>
        </div>
      </ng-template>
    </ngb-carousel>
  </div>

  <div class="col m-1">
      <form class="row align-items-center">
        <mat-form-field class="col" appearance="fill">
          <mat-label translate>product.product</mat-label>
          <input type="text" matInput [matAutocomplete]="autoProduct" [formControl]="productControl" name="product" required>
          <mat-autocomplete #autoProduct [displayWith]="displayFnProduct">
            <mat-option *ngFor="let product of filteredOptionsProduct" [value]="product">
              {{product.name}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <div class="d-flex flex-grow-1 align-items-center">
          <div class="d-flex">
            <mat-icon *ngFor="let label of _rating.labelList" class="d-flex"><img [src]="'assets/img/labels/'+ label.icon" alt="label"></mat-icon>
          </div>
          <ng-template #popContent>
            <mat-selection-list class="m-auto" (selectionChange)="changedLabel($event)" #labels>
              <mat-list-option *ngFor="let label of LABELS" [value]="label" [selected]="isLabelSelected(label)" [class.isSelected]="isLabelSelected(label)">
                <mat-icon mat-list-icon class="d-flex"><img [src]="'assets/img/labels/'+ label.icon" alt="label"></mat-icon>
                <div mat-line translate>{{label.label}}</div>
                <mat-divider class="border-2"></mat-divider>
              </mat-list-option>
            </mat-selection-list>
          </ng-template>
          <button class="m-1" mat-mini-fab color="" placement="bottom" container="body" [ngbPopover]="popContent" [autoClose]="'outside'">
            <mat-icon>local_offer</mat-icon>
          </button>
        </div>

        <mat-form-field class="col text-right" appearance="fill">
          <mat-label translate>product.brand</mat-label>
          <input type="text" matInput [formControl]="brandControl" [matAutocomplete]="autoBrand" name="brand">
          <mat-autocomplete #autoBrand [displayWith]="displayFnBrand">
            <mat-option *ngFor="let option of filteredOptionsBrand" [value]="option">
              {{option}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </form>

    <div class="line"></div>

    <div class="row">
      <div class="col w-50 mx-2 mt-4 p-1 border border-2 rounded">
        <mat-form-field class="w-100 remove-underline">
          <mat-label>{{'profile.desc' | translate}}</mat-label>
          <textarea matInput cdkTextareaAutosize cdkAutosizeMinRows="14" cdkAutosizeMaxRows="14"
                    #descr maxlength="350" [(ngModel)]="_rating.description" name="description"></textarea>
          <mat-hint align="end">{{descr.value.length}} / 350</mat-hint>
        </mat-form-field>
      </div>

      <div class="col list-margin">
          <mat-form-field class="row w-100 align-items-center">
            <mat-label>{{'ratings.addLocation' | translate}}</mat-label>
            <input matInput placeholder="Restaurant/bar/..."
                   [(ngModel)]="_rating.location!.name" name="location">
            <button (click)="openMap()" matSuffix mat-flat-button>
              <mat-icon>location_on</mat-icon>
            </button>
          </mat-form-field> <!--Wenn eine location gefunden wurde (durch vorschläge) dann soll obriges Format eingenommen werden-->


        <div class="row d-flex justify-content-between">

          <div class="d-inline-flex align-items-center">
            <div class="image-wrapper mr-1" *ngFor="let friend of _rating.friends" [style]="'background-image: url(' + friend.profileImage + ');'"></div>
          </div>

          <mat-form-field *ngIf="_rating.friends!.length < 6" class="w-50" appearance="fill">
            <mat-label translate>ratings.tagFriends</mat-label>
            <input type="text" matInput [formControl]="friendsControl" [matAutocomplete]="autoFriends" name="friends">
            <mat-autocomplete #autoFriends [displayWith]="displayFnFriends">
              <mat-option *ngFor="let option of filteredOptionsFriends" [value]="option">
                {{option}}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>

        </div>

        <chips-autocomplete [(type)]="_rating.types" class="row w-100"></chips-autocomplete>

        <ngx-stars class="row justify-content-center" [size]="3" (ratingOutput)="setStars($event)" [initialStars]="_rating.stars" color="black" #stars></ngx-stars>
      </div>
    </div>
  </div>
</div>
